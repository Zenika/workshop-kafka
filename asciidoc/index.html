<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Hybrid-Cloud Streaming Workshop</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<style>
 
 .listingblock:hover .clipboard {
  opacity: 1;
 }

 .clipboard {
  opacity: 0;
     padding: 2px 6px;
     border: 1px solid #d5d5d5;
     font-size: 13px;
     white-space: nowrap;
     font-weight: 500;
     -webkit-appearance: button;
     color: #999;
     line-height: 20px;
     cursor: pointer;
     position: absolute;
     vertical-align: middle;
     background-color: #eee;
     background-image: linear-gradient(#fcfcfc,#eee);
     border-radius: 3px;
     background-repeat: no-repeat;
     top: .85rem !important;
     right: 0.85rem;
     transition: opacity .25s cubic-bezier(0.4, 0, 1, 1);
 }

.clippy {
    margin-top: -10px;
    position: relative;
    top: 3px;
    left: 1px;
}

.clipboard:hover {
  background-image: linear-gradient(#eee,#d3d4d4);
}

.clipboard:active,.clipboard.selected,.clipboard.zeroclipboard-is-active {
    background-color: #dcdcdc;
    background-image: none;
    border-color: #b5b5b5;
    box-shadow: inset 0 2px 4px rgba(0,0,0,.15)
}

</style>
<script>
 $(function() {
     var pre = document.getElementsByTagName('pre');
     for (var i = 0; i < pre.length; i++) {
         var b = document.createElement('button');
         b.innerHTML = '<img class="clippy" src="images/clippy.svg" alt="Copy to clipboard">';
         b.setAttribute('data-clipboard-text', pre[i].textContent);
         b.className = 'clipboard';
         pre[i].appendChild(b);
     }
     new ClipboardJS('.clipboard', {
         target: function(b) {
             var p = b.parentNode;
             return p.className.includes("highlight")
                  ? p.getElementsByClassName("code")[0]
                  : p.childNodes[0];
         }
     })
 });
</script>
<style><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<style>
 
 .listingblock:hover .clipboard {
  opacity: 1;
 }

 .clipboard {
  opacity: 0;
     padding: 2px 6px;
     border: 1px solid #d5d5d5;
     font-size: 13px;
     white-space: nowrap;
     font-weight: 500;
     -webkit-appearance: button;
     color: #999;
     line-height: 20px;
     cursor: pointer;
     position: absolute;
     vertical-align: middle;
     background-color: #eee;
     background-image: linear-gradient(#fcfcfc,#eee);
     border-radius: 3px;
     background-repeat: no-repeat;
     top: .85rem !important;
     right: 0.85rem;
     transition: opacity .25s cubic-bezier(0.4, 0, 1, 1);
 }

.clippy {
    margin-top: -10px;
    position: relative;
    top: 3px;
    left: 1px;
}

.clipboard:hover {
  background-image: linear-gradient(#eee,#d3d4d4);
}

.clipboard:active,.clipboard.selected,.clipboard.zeroclipboard-is-active {
    background-color: #dcdcdc;
    background-image: none;
    border-color: #b5b5b5;
    box-shadow: inset 0 2px 4px rgba(0,0,0,.15)
}

</style>
<script>
 $(function() {
     var pre = document.getElementsByTagName('pre');
     for (var i = 0; i < pre.length; i++) {
         var b = document.createElement('button');
         b.innerHTML = '<img class="clippy" src="images/clippy.svg" alt="Copy to clipboard">';
         b.setAttribute('data-clipboard-text', pre[i].textContent);
         b.className = 'clipboard';
         pre[i].appendChild(b);
     }
     new ClipboardJS('.clipboard', {
         target: function(b) {
             var p = b.parentNode;
             return p.className.includes("highlight")
                  ? p.getElementsByClassName("code")[0]
                  : p.childNodes[0];
         }
     })
 });
</script>
<style><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<style>
 
 .listingblock:hover .clipboard {
  opacity: 1;
 }

 .clipboard {
  opacity: 0;
     padding: 2px 6px;
     border: 1px solid #d5d5d5;
     font-size: 13px;
     white-space: nowrap;
     font-weight: 500;
     -webkit-appearance: button;
     color: #999;
     line-height: 20px;
     cursor: pointer;
     position: absolute;
     vertical-align: middle;
     background-color: #eee;
     background-image: linear-gradient(#fcfcfc,#eee);
     border-radius: 3px;
     background-repeat: no-repeat;
     top: .85rem !important;
     right: 0.85rem;
     transition: opacity .25s cubic-bezier(0.4, 0, 1, 1);
 }

.clippy {
    margin-top: -10px;
    position: relative;
    top: 3px;
    left: 1px;
}

.clipboard:hover {
  background-image: linear-gradient(#eee,#d3d4d4);
}

.clipboard:active,.clipboard.selected,.clipboard.zeroclipboard-is-active {
    background-color: #dcdcdc;
    background-image: none;
    border-color: #b5b5b5;
    box-shadow: inset 0 2px 4px rgba(0,0,0,.15)
}

</style>
<script>
 $(function() {
     var pre = document.getElementsByTagName('pre');
     for (var i = 0; i < pre.length; i++) {
         var b = document.createElement('button');
         b.innerHTML = '<img class="clippy" src="images/clippy.svg" alt="Copy to clipboard">';
         b.setAttribute('data-clipboard-text', pre[i].textContent);
         b.className = 'clipboard';
         pre[i].appendChild(b);
     }
     new ClipboardJS('.clipboard', {
         target: function(b) {
             var p = b.parentNode;
             return p.className.includes("highlight")
                  ? p.getElementsByClassName("code")[0]
                  : p.childNodes[0];
         }
     })
 });
</script>
<style><style>


/* latin-ext */
@font-face {
  font-family: "MarkOT";
  font-style: normal;
  font-weight: normal;
  src: local("Mark OT"), local("Mark-OT"), url("https://cdn.confluent.io/fonts/MarkOT/MarkOT.woff2") format("woff2");
}

@font-face {
  font-family: "MarkOT";
  font-style: italic;
  font-weight: normal;
  src: local("Mark OT"), local("Mark-OT"),
    url("https://cdn.confluent.io/fonts/MarkOT/MarkOT-Italic.woff2") format("woff2");
}

@font-face {
  font-family: "MarkOT";
  font-style: normal;
  font-weight: 500;
  src: local("Mark OT"), local("Mark-OT"),
    url("https://cdn.confluent.io/fonts/MarkOT/MarkOT-Medium.woff2") format("woff2");
}

@font-face {
  font-family: "MarkOT";
  font-style: italic;
  font-weight: 500;
  src: local("Mark OT"), local("Mark-OT"),
    url("https://cdn.confluent.io/fonts/MarkOT/MarkOT-MediumItalic.woff2") format("woff2");
}

@font-face {
  font-family: "MarkOT";
  font-style: normal;
  font-weight: bold;
  src: local("Mark OT Bold"), local("Mark-OT-Bold"),
    url("https://cdn.confluent.io/fonts/MarkOT/MarkOT-Bold.woff2") format("woff2");
}

@font-face {
  font-family: "MarkOT";
  font-style: italic;
  font-weight: bold;
  src: local("Mark OT Bold"), local("Mark-OT-Bold"),
    url("https://cdn.confluent.io/fonts/MarkOT/MarkOT-BoldItalic.woff2") format("woff2");
}

@font-face {
  font-family: "MarkOT";
  font-style: normal;
  font-weight: 300;
  src: local("Mark OT Narrow Light"), local("Mark-OT-Narrow-Light"),
    url("https://cdn.confluent.io/fonts/MarkOT/MarkOT-NarrowLight.woff2") format("woff2");
}

@font-face {
  font-family: "MarkOT";
  font-style: italic;
  font-weight: 300;
  src: local("Mark OT Narrow Light"), local("Mark-OT-Narrow-Light"),
    url("https://cdn.confluent.io/fonts/MarkOT/MarkOT-NarrowLightItalic.woff2") format("woff2");
}


/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: MarkOT; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0;  }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 1.9em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: #ffffff; color: #222222; padding: 0; margin: 0; font-family: "MarkOT", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.stretch { width: 100%; }

p.lead { font-size: 1.15625em; line-height: 1.69; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #4d4d4d; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #4597CB; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #4597CB; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: 'MarkOT', "Helvetica Neue", Helvetica, "Liberation Sans", Arial, sans-serif; font-weight: normal; font-size: 1.0em; line-height: 1.69; margin-bottom: 1.375em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "MarkOT", "Helvetica Neue", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #173361; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #4d4d4d; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: monospace; font-size: 1.1em; font-weight: normal; color: #000000; line-height: 1.69; }

/* Lists */
ul, ol, dl { font-size: 0.9375em; line-height: 1.4; margin-bottom: 1.375em; list-style-position: outside; font-family: "MarkOT", Helvetica, "Liberation Sans", Arial, sans-serif; }

ul, ol { margin-left: 1.625em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.625em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #404040; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.375em; padding: 0 0 0 1em; border-left: 5px solid #ededed; }
blockquote cite { display: block; font-size: 0.8125em; color: #333333; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #333333; }

blockquote, blockquote p { line-height: 1.4; color: #404040; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.4875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

body { -moz-osx-font-smoothing: grayscale; -webkit-font-smoothing: antialiased; tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }

a:hover, a:focus { text-decoration: underline; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

:not(pre):not([class^=L]) > code { font-size: 0.9375em; font-style: normal !important; letter-spacing: 0; padding: 1px 4px; background-color: #eff1f1; border: 1px solid #d4d9d9; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; word-wrap: break-word; }

:not(pre) > code.nobreak { word-wrap: normal; }
:not(pre) > code.nowrap { white-space: nowrap; }

pre { color: #000000; font-family: monospace,Menlo, Monaco, "Liberation Mono", Consolas; line-height: 1.69; -webkit-font-smoothing: antialiased; font-weight: normal; }
pre code, pre pre { color: inherit; font-size: inherit; line-height: inherit; }
pre > code { display: block; }

pre.nowrap, pre.nowrap pre { white-space: pre; word-wrap: normal; }

em em { font-style: normal; }

strong strong { font-weight: normal; }

.keyseq { color: #737373; }

kbd { font-family: Menlo, Monaco, "Liberation Mono", Consolas, monospace; display: inline-block; color: #404040; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menuref { color: #000; }

.menuseq b:not(.caret), .menuref { font-weight: inherit; }

.menuseq { word-spacing: -0.02em; }
.menuseq b.caret { font-size: 1.25em; line-height: 0.8; }
.menuseq i.caret { font-weight: bold; text-align: center; width: 0.45em; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

/* Control max width here */
#header , #content, #footnotes, #footer {  width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 1150px; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before {content:url(./images/confluent-logo-300.png);} #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { background:#ffffff; color: #173361; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #666666; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #829494; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #333333; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #404040; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #404040; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1em; margin-bottom: 1.25rem; }

#toc { border-bottom: 0 solid #ffffff; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "MarkOT", "Helvetica Neue", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #4d4d4d; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background: #e5e5e5; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #cccccc; margin-bottom: 1.25em; padding: 1.25em; background: #e5e5e5; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background: white; padding: 1.25em; }

#footer-text { color: #666666; line-height: 1.26; }

#content { margin-bottom: 0.625em; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { #content { margin-bottom: 1.25em; }
  .sect1 { padding-bottom: 1.25em; } }
.sect1:last-child { padding-bottom: 0; }

.sect1 + .sect1 { border-top: 0 solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: black; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: black; }

details, .audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

details > summary:first-of-type { cursor: pointer; display: list-item; outline: none; margin-bottom: 0.75em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock.fit-content > caption.title { white-space: nowrap; width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > [class="paragraph"]:first-of-type p { font-size: 1.15625em; line-height: 1.6; color: black; }

table.tableblock #preamble > .sectionbody > [class="paragraph"]:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "MarkOT", "Helvetica Neue", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #333333; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #cccccc; margin-bottom: 1.25em; padding: 1.25em; background: #e5e5e5; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #c6c6c6; margin-bottom: 1.25em; padding: 1.25em; background: #e0e0e0; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #4d4d4d; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock > .content > pre { border: 0 0 0 2px solid rgba(120, 120, 120, 0.35); -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; overflow-x: auto; padding: 1em 1.5em 0.875em 1.5em; font-size: 0.8125em; }
@media only screen and (min-width: 768px) { .literalblock pre, .listingblock > .content > pre { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .listingblock > .content > pre { font-size: 1em; } }

/* Code blocks */
.literalblock pre, .listingblock > .content > pre:not(.highlight), .listingblock > .content > pre[class="highlight"], .listingblock > .content > pre[class^="highlight "] { border:1px #f9f9fa solid; background: #f9f9fa; border-radius: 4px; font-family:monospace; font-size:1.1em}

.literalblock.output pre { color: #eff1f1; background-color: #3b3b3b; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: inherit; opacity: 0.5; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: inherit; opacity: 0.5; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1em 1.5em 0.875em 1.5em; -webkit-border-radius: 0; border-radius: 0; }

.prettyprint { background: #eff1f1; }

pre.prettyprint .linenums { line-height: 1.6; margin-left: 2em; }

pre.prettyprint li { background: none; list-style-type: inherit; padding-left: 0; }

pre.prettyprint li code[data-lang]:before { opacity: 1; }

pre.prettyprint li:not(:first-child) code[data-lang]:before { display: none; }

table.linenotable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }
table.linenotable td[class] { color: inherit; vertical-align: top; padding: 0; line-height: inherit; white-space: normal; }
table.linenotable td.code { padding-left: 0.75em; }
table.linenotable td.linenos { border-right: 1px solid currentColor; opacity: 0.35; padding-right: 0.5em; }

pre.pygments .lineno { border-right: 1px solid currentColor; opacity: 0.35; display: inline-block; margin-right: 0.75em; }
pre.pygments .lineno:before { content: ""; margin-right: -0.125em; }

.quoteblock { margin: 0 1em 1.375em 1.5em; display: table; }
.quoteblock:not(.excerpt) > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock p { background-color: #fff; color: #666666; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #4d4d4d; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.75em; margin-right: 0.5ex; text-align: right; }

.verseblock { margin: 0 1em 1.375em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #404040; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: #333333; }

.quoteblock.abstract blockquote:before, .quoteblock.excerpt blockquote:before, .quoteblock .quoteblock blockquote:before { display: none; }
.quoteblock.abstract blockquote, .quoteblock.abstract p, .quoteblock.excerpt blockquote, .quoteblock.excerpt p, .quoteblock .quoteblock blockquote, .quoteblock .quoteblock p { line-height: 1.6; word-spacing: 0; }
.quoteblock.abstract { margin: 0 1em 1.375em 1em; display: block; }
.quoteblock.abstract > .title { margin: 0 0 0.375em 0; font-size: 1.15em; text-align: center; }
.quoteblock.excerpt > blockquote, .quoteblock .quoteblock { padding: 0 0 0.25em 1em; border-left: 0.25em solid #dddddd; }
.quoteblock.excerpt, .quoteblock .quoteblock { margin-left: 0; }
.quoteblock.excerpt blockquote, .quoteblock.excerpt p, .quoteblock .quoteblock blockquote, .quoteblock .quoteblock p { color: inherit; font-size: 1.0625rem; }
.quoteblock.excerpt .attribution, .quoteblock .quoteblock .attribution { color: inherit; text-align: left; margin-right: 0; }

table.tableblock { max-width: 100%; border-collapse: separate; }

p.tableblock:last-child { margin-bottom: 0; }

td.tableblock > .content { margin-bottom: 1.375em; }
td.tableblock > .content > :last-child { margin-bottom: -1.375em; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock { border-width: 0 1px 1px 0; }

table.grid-all > tfoot > tr > .tableblock { border-width: 1px 1px 0 0; }

table.grid-cols > * > tr > .tableblock { border-width: 0 1px 0 0; }

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock { border-width: 0 0 1px 0; }

table.grid-rows > tfoot > tr > .tableblock { border-width: 1px 0 0 0; }

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock { border-bottom-width: 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot, table.frame-ends { border-width: 1px 0; }

table.stripes-all tr, table.stripes-odd tr:nth-of-type(odd), table.stripes-even tr:nth-of-type(even), table.stripes-hover tr:hover { background: #f9f9f9; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

ol { margin-left: 1.875em; }

ul li ol { margin-left: 1.625em; }

dl dd { margin-left: 2em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.6875em; }

ul.checklist, ul.none, ol.none, ul.no-bullet, ol.no-bullet, ol.unnumbered, ul.unstyled, ol.unstyled { list-style-type: none; }

ul.no-bullet, ol.no-bullet, ol.unnumbered { margin-left: 0.625em; }

ul.unstyled, ol.unstyled { margin-left: 0; }

ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1.25em; font-size: 0.8em; position: relative; bottom: 0.125em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.inline { display: -ms-flexbox; display: -webkit-box; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; list-style: none; margin: 0 0 0.6875em -1.375em; }

ul.inline > li { margin-left: 1.375em; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.375em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist td:not([class]):first-child { padding: 0.4em 0.75em 0 0.75em; line-height: 1; vertical-align: top; }
.colist td:not([class]):first-child img { max-width: none; }
.colist td:not([class]):last-child { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; margin-left: -1.05em; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }
a span.icon > .fa { cursor: inherit; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #004c73; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f12a"; color: #D8365D; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #404040; -webkit-border-radius: 50%; border-radius: 50%; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

#header {padding-top:2.9em;} #content, #footnotes { background: white; padding-left: 2.5em; padding-right: 2.5em; }

#header { margin-bottom: 0; }
#header > h1 { border-bottom: none; }

.literalblock pre, .listingblock pre { background: #f9f9fa; }

#footnotes { margin-bottom: 2em; }

.sect1 { padding-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .olist, .olist .ulist { margin-bottom: 0.34375em; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book">
<div id="header">
<h1>Hybrid-Cloud Streaming Workshop</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_lab_1_connecting_to_your_workshop_environment">Lab 1: Connecting to your Workshop Environment</a></li>
<li><a href="#_lab_2_getting_started">Lab 2: Getting Started</a></li>
<li><a href="#_lab_3_stream_events_to_confluent_platform">Lab 3: Stream Events to Confluent Platform</a></li>
<li><a href="#_lab_4_stream_events_to_confluent_cloud">Lab 4: Stream Events to Confluent Cloud</a></li>
<li><a href="#_lab_5_creating_a_ksqldb_application">Lab 5: Creating a ksqlDB Application</a></li>
<li><a href="#_lab_6_querying_streams_with_ksqldb">Lab 6: Querying Streams with ksqlDB</a></li>
<li><a href="#_lab_7_creating_ksqldb_tables">Lab 7: Creating ksqlDB tables</a></li>
<li><a href="#_lab_8_joining_steams_tables_with_ksqldb">Lab 8: Joining Steams &amp; Tables with ksqlDB</a></li>
<li><a href="#_lab_9_streaming_current_stock_levels">Lab 9: Streaming Current Stock Levels</a></li>
<li><a href="#_lab_10_pull_queries">Lab 10: Pull Queries</a></li>
<li><a href="#_lab_11_streaming_recent_product_demand">Lab 11: Streaming Recent Product Demand</a></li>
<li><a href="#_lab_12_streaming_out_of_stock_events">Lab 12: Streaming <em>"Out of Stock"</em> Events</a></li>
<li><a href="#_lab_13_replicate_events_to_on_premise_kafka">Lab 13: Replicate Events to On-Premise Kafka</a></li>
<li><a href="#_lab_14_sink_events_into_mysql">Lab 14: Sink Events into MySQL</a></li>
<li><a href="#_wrapping_up">Wrapping up</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The popularity of Hybrid and Multi cloud architectures are on the rise as organizations continue to take advantage of cloud computing.</p>
</div>
<div class="paragraph">
<p>Some of the requirements driving these new modern architectures are as follows.</p>
</div>
<div class="paragraph">
<p><strong>Organizations need to&#8230;&#8203;</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Synchronize data between on-premise and the cloud</p>
</li>
<li>
<p>Migrate data from on-premise into the cloud</p>
</li>
<li>
<p>Synchronize data across multiple cloud providers to reduce risk</p>
</li>
<li>
<p>Synchronize data across multiple cloud providers to avoid vendor lock-in</p>
</li>
<li>
<p>Access the best-in-breed services across multiple cloud providers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to Hybrid and Multi cloud architectures, organizations are also looking to become more event driven. The Confluent Platform is a streaming platform that can stream data, in real time, to the systems that need it, when they need it, across an entire organization. Processes that were once batch can now become real time, every event can be used to trigger other services and this can all be done using a common API with low latency and high throughput.</p>
</div>
<div class="paragraph">
<p>In this workshop we will explore how the Confluent Platform and Confluent Cloud can enable these architectures by building a real time supply and demand appplication using ksqlDB.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/architecture.png" alt="Workshop Architecture Diagram">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_1_connecting_to_your_workshop_environment">Lab 1: Connecting to your Workshop Environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Your environment represents an on-premise data center and consists of a virtual machine hosted in the cloud running several docker containers. In a real world implementation, some of the components would be deployed differently but the logical data flow that we will be working on would remain the same.</p>
</div>
<div class="paragraph">
<p>To login to your virtual data center open a terminal session and use the credentials that were assigned to you</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ssh dc@localhost</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once logged in run the following command to confirm that you have several docker containers running</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>docker ps --format "table {{.ID}}\t{{.Names}}\t{{.RunningFor}}\t{{.Status}}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see something similar to this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>CONTAINER ID        NAMES                     CREATED             STATUS
ef959fb9e566        db-trans-simulator        3 minutes ago       Up 3 minutes
979c20e26e60        ksqldb-cli                3 minutes ago       Up 3 minutes
0d9e1fa2c83f        ksqldb-server-ccloud      3 minutes ago       Up 3 minutes
4eb1ba589357        control-center            3 minutes ago       Up 3 minutes
e83088712e60        kafka-connect-ccloud      3 minutes ago       Up 3 minutes
c2362c0fc8e0        kafka-connect-onprem      3 minutes ago       Up 3 minutes
82086be4e239        schema-registry           3 minutes ago       Up 3 minutes
62b037976674        broker                    3 minutes ago       Up 3 minutes
92c955b221f3        zookeeper                 3 minutes ago       Up 3 minutes
0794f9008bb6        mysql                     3 minutes ago       Up 3 minutes (healthy)
31c3c1372aa1        workshop-docs-webserver   3 minutes ago       Up 3 minutes</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Whenever you see this icon it means the step is mandatory. Missing one of these steps will result in the data pipeline not working as expected.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Take advantage of the copy to clipboard button, it will save you some time!</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/copypaste.png" alt="copypaste">
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_2_getting_started">Lab 2: Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The primary data source for this workshop is a MySQL database running in your data center. Connected to this database is a orders application which we will discuss shortly.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/1_mysql.png" alt="1 mysql">
</div>
</div>
<div class="sect2">
<h3 id="_database_schema">Database Schema</h3>
<div class="paragraph">
<p>The MySQL database contains a simple schema that includes <em>Customer</em>, <em>Supplier</em>, <em>Product</em>, <em>Sales Order</em> and <em>Purchase Order</em> information.</p>
</div>
<div class="paragraph">
<p>The idea behind this schema is simple, customers order products from a company and sales orders get created, the company then sends purchase orders to their suppliers so that product demand can be met by maintaining sensible stock levels.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/mysql_schema.png" alt="MySQL schema">
</div>
</div>
<div class="paragraph">
<p>We can inspect this schema further by logging into the MySQL CLI&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>docker exec -it mysql bash -c 'mysql -u root -p$MYSQL_ROOT_PASSWORD --database orders'</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and viewing your tables</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>show tables;</code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s an extra table here called <code>dc_out_of_stock_events</code> that not in the schema diagram above, we&#8217;ll cover this table separately later on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+--------------------------+
| Tables_in_orders         |
+--------------------------+
| customers                |
| dc_out_of_stock_events |
| products                 |
| purchase_order_details   |
| purchase_orders          |
| sales_order_details      |
| sales_orders             |
| suppliers                |
+--------------------------+
8 rows in set (0.00 sec)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s view the row count for each table</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>SELECT * from (
  SELECT 'customers' as table_name, COUNT(*) FROM customers
  UNION
  SELECT 'products' as table_name, COUNT(*) FROM products
  UNION
  SELECT 'suppliers' as table_name, COUNT(*) FROM suppliers
  UNION
  SELECT 'sales_orders' as table_name, COUNT(*) FROM sales_orders
  UNION
  SELECT 'sales_order_details' as table_name, COUNT(*) FROM sales_order_details
  UNION
  SELECT 'purchase_orders' as table_name, COUNT(*) FROM purchase_orders
  UNION
  SELECT 'purchase_order_details' as table_name, COUNT(*) FROM purchase_order_details
) row_counts;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, we have 30 customers, suppliers and products, 0 sales orders and 1 purchase order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+------------------------+----------+
| table_name             | COUNT(*) |
+------------------------+----------+
| customers              |       30 |
| products               |       30 |
| suppliers              |       30 |
| sales_orders           |        0 |
| sales_order_details    |        0 |
| purchase_orders        |        1 |
| purchase_order_details |       30 |
+------------------------+----------+
7 rows in set (0.00 sec)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The single purchase order was created so we have something in stock to sell, let&#8217;s have a look at what was ordered.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>SELECT * FROM purchase_order_details;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+----+-------------------+------------+----------+------+
| id | purchase_order_id | product_id | quantity | cost |
+----+-------------------+------------+----------+------+
|  1 |                 1 |          1 |      100 | 6.82 |
|  2 |                 1 |          2 |      100 | 7.52 |
|  3 |                 1 |          3 |      100 | 6.16 |
|  4 |                 1 |          4 |      100 | 8.07 |
|  5 |                 1 |          5 |      100 | 2.10 |
|  6 |                 1 |          6 |      100 | 7.45 |
|  7 |                 1 |          7 |      100 | 4.02 |
|  8 |                 1 |          8 |      100 | 0.64 |
|  9 |                 1 |          9 |      100 | 8.51 |
| 10 |                 1 |         10 |      100 | 3.61 |
| 11 |                 1 |         11 |      100 | 2.62 |
| 12 |                 1 |         12 |      100 | 2.60 |
| 13 |                 1 |         13 |      100 | 1.26 |
| 14 |                 1 |         14 |      100 | 4.08 |
| 15 |                 1 |         15 |      100 | 3.56 |
| 16 |                 1 |         16 |      100 | 7.13 |
| 17 |                 1 |         17 |      100 | 7.64 |
| 18 |                 1 |         18 |      100 | 5.94 |
| 19 |                 1 |         19 |      100 | 2.94 |
| 20 |                 1 |         20 |      100 | 1.91 |
| 21 |                 1 |         21 |      100 | 8.89 |
| 22 |                 1 |         22 |      100 | 7.62 |
| 23 |                 1 |         23 |      100 | 6.19 |
| 24 |                 1 |         24 |      100 | 2.83 |
| 25 |                 1 |         25 |      100 | 5.51 |
| 26 |                 1 |         26 |      100 | 4.23 |
| 27 |                 1 |         27 |      100 | 8.33 |
| 28 |                 1 |         28 |      100 | 7.09 |
| 29 |                 1 |         29 |      100 | 1.75 |
| 30 |                 1 |         30 |      100 | 1.72 |
+----+-------------------+------------+----------+------+
30 rows in set (0.00 sec)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we have a single purchase order that is procuring 100 of each product, this reflects our initial and current stock levels.</p>
</div>
<div class="paragraph">
<p>Type <code>exit</code> to leave the MySQL CLI</p>
</div>
</div>
<div class="sect2">
<h3 id="_starting_the_orders_application">Starting the Orders Application</h3>
<div class="paragraph">
<p>To start generating some sales orders we need to start the orders application. This application will continuously create new sales orders to simulate product demand. The application will also raise purchase orders when told to do so, we&#8217;ll cover this aspect later on in the workshop.</p>
</div>
<div class="paragraph">
<p>Start the orders application by running the following command.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>docker exec -dit db-trans-simulator sh -c "python -u /simulate_dbtrans.py &gt; /proc/1/fd/1 2&gt;&amp;1"</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Confirm that the simulator is working as expected</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>docker logs -f db-trans-simulator</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see an output like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Sales Order 1 Created
Sales Order 2 Created
Sales Order 3 Created
Sales Order 4 Created
Sales Order 5 Created
Sales Order 6 Created
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Press <code>ctrl-c</code> to quit</p>
</div>
<div class="paragraph">
<p>We now have <code>sales_order</code> and <code>sales_order_details</code> rows being created for us by the orders application.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_3_stream_events_to_confluent_platform">Lab 3: Stream Events to Confluent Platform</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have data being automatically created in our MySQL database it&#8217;s time to stream those changes into your on-premise Kafka cluster. We can do this using the <a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html" target="_blank" rel="noopener">Debezium MySQL Source connector</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/2_mysql_source_connector.png" alt="2 mysql source connector">
</div>
</div>
<div class="sect2">
<h3 id="_create_the_mysql_source_connector">Create the MySQL source connector</h3>
<div class="paragraph">
<p>We have a Kafka Connect worker already up and running in a docker container called <code>kafka-connect-onprem</code>. This Kafka Connect worker is configured to connect to your on-premise Kafka cluster and has a internal REST server listening on port <code>18083</code>. We can create a connector from the command line using the cURL command. The cURL command allows us to send an HTTP POST request to the REST server, the '-H' option specifies the header of the request and includes the target host and port information, the <code>-d</code> option specifies the data we will send, in this case its the configuration options for the connector. You can of course create and manage connectors using any tool or language capable of issuing HTTP requests.</p>
</div>
<div class="paragraph">
<p>To create the Debezium MySQL Source connector instance run the following command:-</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>curl -i -X POST -H "Accept:application/json" \
  -H  "Content-Type:application/json" http://localhost:18083/connectors/ \
  -d '{
    "name": "mysql-source-connector",
    "config": {
          "connector.class": "io.debezium.connector.mysql.MySqlConnector",
          "database.hostname": "mysql",
          "database.port": "3306",
          "database.user": "mysqluser",
          "database.password": "mysqlpw",
          "database.server.id": "12345",
          "database.server.name": "dc",
          "database.whitelist": "orders",
          "table.blacklist": "orders.dc_out_of_stock_events",
          "database.history.kafka.bootstrap.servers": "broker:29092",
          "database.history.kafka.topic": "debezium_dbhistory" ,
          "include.schema.changes": "false",
          "snapshot.mode": "when_needed",
          "transforms": "unwrap,sourcedc,TopicRename,extractKey",
          "transforms.unwrap.type": "io.debezium.transforms.UnwrapFromEnvelope",
          "transforms.sourcedc.type":"org.apache.kafka.connect.transforms.InsertField$Value",
          "transforms.sourcedc.static.field":"sourcedc",
          "transforms.sourcedc.static.value":"dc",
          "transforms.TopicRename.type": "org.apache.kafka.connect.transforms.RegexRouter",
          "transforms.TopicRename.regex": "(.*)\\.(.*)\\.(.*)",
          "transforms.TopicRename.replacement": "$1_$3",
          "transforms.extractKey.type": "org.apache.kafka.connect.transforms.ExtractField$Key",
          "transforms.extractKey.field": "id",
          "key.converter": "org.apache.kafka.connect.converters.IntegerConverter"
      }
  }'</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can confirm the connector is running by querying the REST interface</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>curl -s localhost:18083/connectors/mysql-source-connector/status | jq</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see that the connector&#8217;s state is <code>RUNNING</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>{
  "name": "mysql-source-connector",
  "connector": {
    "state": "RUNNING",
    "worker_id": "kafka-connect-onprem:18083"
  },
  "tasks": [
    {
      "id": 0,
      "state": "RUNNING",
      "worker_id": "kafka-connect-onprem:18083"
    }
  ],
  "type": "source"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_view_messages_in_confluent_control_center">View Messages in Confluent Control Center</h3>
<div class="paragraph">
<p>Now that the MySQL source connector is up and running, we will be able to see messages appear in our local Kafka cluster.</p>
</div>
<div class="paragraph">
<p>We can use <a href="http://localhost:9021" target="_blank" rel="noopener">Confluent Control Center</a> to confirm this.</p>
</div>
<div class="paragraph">
<p>Use the following and username and password to authenticate to Confluent Control Center</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Username: dc
Password: your workshop password</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/c3_05.png" alt="c3 05">
</div>
</div>
<div class="paragraph">
<p>On the landing page we can see that Confluent Control Center is monitoring two Kafka Clusters, our on-premise cluster and a Confluent Cloud Cluster</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/c3_10.png" alt="c3 10">
</div>
</div>
<div class="paragraph">
<p>On the left hand navigation bar select "CO" (Controlcenter.cluster), this is your on-premise cluster.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/c3_20.png" alt="c3 20">
</div>
</div>
<div class="paragraph">
<p>Select the Topics Menu on the left</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/c3_30.png" alt="c3 30">
</div>
</div>
<div class="paragraph">
<p>Select the <code>dc_sales_order_details</code> topic</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/c3_40.png" alt="c3 40">
</div>
</div>
<div class="paragraph">
<p>Finally select the Messages tab and observe that messages are being streamed into Kafka from MySQL in real time.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/c3_50.png" alt="c3 50">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Further Reading</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://debezium.io/documentation/reference/1.1/connectors/mysql.html#mysql-connector-configuration-properties_debezium" target="_blank" rel="noopener">Debezium MySQL Configuration Options</a></p>
</li>
<li>
<p><a href="https://docs.confluent.io/current/connect/references/restapi.html">Kafka Connect REST API</a></p>
</li>
<li>
<p><a href="https://curl.haxx.se/docs/manpage.html">cURL manpage</a></p>
</li>
<li>
<p><a href="https://docs.confluent.io/current/control-center/index.html">Confluent Control Center Documentation</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_4_stream_events_to_confluent_cloud">Lab 4: Stream Events to Confluent Cloud</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that your on-premise Kafka cluster is receiving events from your MySQL Database let&#8217;s use Confluent Replicator to stream those messages to Confluent Cloud</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/3_replicate_to_ccloud.png" alt="3 replicate to ccloud">
</div>
</div>
<div class="sect2">
<h3 id="_create_the_replicator_connector_instance">Create the Replicator Connector Instance</h3>
<div class="paragraph">
<p>Confluent Replicator uses Kafka Connect under the covers and can be considered a special type of connector, however, unlike other connectors, the source <em>and</em> target technology for the connector is a Kafka Cluster.</p>
</div>
<div class="paragraph">
<p>To support this connector, we have another Kafka Connect worker running in a different docker container called <code>kafka-connect-ccloud</code>. This Kafka Connect worker is configured to connect to the Confluent Cloud instance provisioned for this workshop. This Kafka Connect worker has an internal REST server listening on port <code>18084</code>.</p>
</div>
<div class="paragraph">
<p>Run the following from the command line to create the Replicator Connector instance, this connector will replicate events from you on-premise Kafka cluster to your Confluent Cloud Cluster.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>curl -i -X POST -H "Accept:application/json" \
    -H  "Content-Type:application/json" http://localhost:18084/connectors/ \
    -d '{
        "name": "replicator-dc-to-ccloud",
        "config": {
          "connector.class": "io.confluent.connect.replicator.ReplicatorSourceConnector",
          "key.converter": "io.confluent.connect.replicator.util.ByteArrayConverter",
          "value.converter": "io.confluent.connect.replicator.util.ByteArrayConverter",
          "topic.config.sync": false,
          "topic.regex": "dc[0-9][0-9][_].*",
          "topic.blacklist": "dc_out_of_stock_events",
          "dest.kafka.bootstrap.servers": "${file:/secrets.properties:CCLOUD_CLUSTER_ENDPOINT}",
          "dest.kafka.security.protocol": "SASL_SSL",
          "dest.kafka.sasl.mechanism": "PLAIN",
          "dest.kafka.sasl.jaas.config": "org.apache.kafka.common.security.plain.PlainLoginModule required username=\"${file:/secrets.properties:CCLOUD_API_KEY}\" password=\"${file:/secrets.properties:CCLOUD_API_SECRET}\";",
          "dest.kafka.replication.factor": 3,
          "src.kafka.bootstrap.servers": "broker:29092",
          "src.consumer.group.id": "replicator-dc-to-ccloud",
          "src.consumer.interceptor.classes": "io.confluent.monitoring.clients.interceptor.MonitoringConsumerInterceptor",
          "src.consumer.confluent.monitoring.interceptor.bootstrap.servers": "broker:29092",
          "src.kafka.timestamps.producer.interceptor.classes": "io.confluent.monitoring.clients.interceptor.MonitoringProducerInterceptor",
          "src.kafka.timestamps.producer.confluent.monitoring.interceptor.bootstrap.servers": "broker:29092",
          "tasks.max": "1"
        }
    }'</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Confirm that Replicator is in a <code>RUNNING</code> state</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>curl -s localhost:18084/connectors/replicator-dc-to-ccloud/status | jq</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>{
  "name": "replicator-dc-to-ccloud",
  "connector": {
    "state": "RUNNING",
    "worker_id": "kafka-connect-ccloud:18084"
  },
  "tasks": [
    {
      "id": 0,
      "state": "RUNNING",
      "worker_id": "kafka-connect-ccloud:18084"
    }
  ],
  "type": "source"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_confirm_that_messages_are_arriving_in_confluent_cloud">Confirm that Messages are Arriving in Confluent Cloud</h3>
<div class="paragraph">
<p>Jump back to <a href="http://localhost:9021" target="_blank" rel="noopener">Confluent Control Center</a></p>
</div>
<div class="paragraph">
<p>Select the "CC" cluster from the left-hand navigation bar and then select "Topics".</p>
</div>
<div class="paragraph">
<p>This Confluent Cloud Instance is being shared by other users of the workshop and as a result you will see topics being replicated from other data centers. To see just your topics, type your data center name, dc, into the search box at the top to filter.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/c3_60.png" alt="c3 60">
</div>
</div>
<div class="paragraph">
<p>Select the <code>dc_sales_order_details</code> topic and finally the "Messages" tab under the topic heading. You should see messages streaming in from your on-premise Kafka cluster.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/c3_70.png" alt="c3 70">
</div>
</div>
<div class="paragraph">
<p>We can also view the status of Replicator in Confluent Control Center by selecting "Replicators" on the left-hand navigation pane. Here we can see throughput and latency statistics.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/c3_72.png" alt="c3 72">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Further Reading</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.confluent.io/current/connect/kafka-connect-replicator/index.html">Confluent Replicator</a></p>
</li>
<li>
<p><a href="https://docs.confluent.io/current/connect/kafka-connect-replicator/configuration_options.html">Confluent Replicator Configuration Properties</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_5_creating_a_ksqldb_application">Lab 5: Creating a ksqlDB Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We now have all the data we need being streamed, in realtime, to Confluent Cloud. You have a ksqlDB Server running inside a docker container that is configured to point to our Confluent Cloud cluster. In a real world deployment, it is likely that this ksqlDB Server would be running closer to Confluent Cloud but for the purposes of this workshop it is not important.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/4_ksql_application.png" alt="4 ksql application">
</div>
</div>
<div class="paragraph">
<p>Below is an illustration of the completed Supply &amp; Demand ksqlDB Application, over the next few labs you will be building this step-by-step.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ksqlDB_topology.png" alt="ksqlDB topology">
</div>
</div>
<div class="sect2">
<h3 id="_start_the_ksqldb_cli">Start the ksqlDB CLI</h3>
<div class="paragraph">
<p>To start the ksqlDB CLI run the following command:-</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>docker exec -it ksqldb-cli ksql http://ksqldb-server-ccloud:8088</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should see something like this:-</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>                  ===========================================
                  =       _              _ ____  ____       =
                  =      | | _____  __ _| |  _ \| __ )      =
                  =      | |/ / __|/ _` | | | | |  _ \      =
                  =      |   &lt;\__ \ (_| | | |_| | |_) |     =
                  =      |_|\_\___/\__, |_|____/|____/      =
                  =                   |_|                   =
                  =  Event Streaming Database purpose-built =
                  =        for stream processing apps       =
                  ===========================================

Copyright 2017-2020 Confluent Inc.

CLI v0.9.0, Server v0.9.0 located at http://ksqldb-server-ccloud:8088

Having trouble? Type 'help' (case-insensitive) for a rundown of how things work!

ksql&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ksqlDB CLI is pointing at a ksqlDB Server connected to your Confluent Cloud instance.</p>
</div>
<div class="paragraph">
<p>To view a list of all topics in Confluent Cloud run the following command:-</p>
</div>
<div class="paragraph">
<p><code>show topics;</code></p>
</div>
<div class="paragraph">
<p>You should see your own topics, <code>dc_*</code>, along with topics from other workshop users.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ksql&gt; show topics;

 Kafka Topic                 | Partitions | Partition Replicas
---------------------------------------------------------------
 dc01_customers              | 1          | 3
 dc01_products               | 1          | 3
 dc01_purchase_order_details | 1          | 3
 dc01_purchase_orders        | 1          | 3
 dc01_sales_order_details    | 1          | 3
 dc01_sales_orders           | 1          | 3
 dc01_suppliers              | 1          | 3
 dc02_customers              | 1          | 3
 dc02_products               | 1          | 3
 dc02_purchase_order_details | 1          | 3
 dc02_purchase_orders        | 1          | 3
 dc02_sales_order_details    | 1          | 3
...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inspect_a_topics_contents">Inspect a topic's contents</h3>
<div class="paragraph">
<p>To inspect the contents of a topic run the following:-</p>
</div>
<div class="paragraph">
<p><code>PRINT dc_sales_orders;</code></p>
</div>
<div class="paragraph">
<p>You should see something similar:-</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ksql> PRINT dc_sales_orders;
Key format: AVRO
Value format: AVRO
rowtime: 2020/05/20 10:10:29.264 Z, key: {"id": 1}, value: {"id": 1, "order_date": 1589969387000, "customer_id": 14, "sourcedc": "dc"}
rowtime: 2020/05/20 10:10:29.265 Z, key: {"id": 2}, value: {"id": 2, "order_date": 1589969392000, "customer_id": 14, "sourcedc": "dc"}
rowtime: 2020/05/20 10:10:29.265 Z, key: {"id": 3}, value: {"id": 3, "order_date": 1589969397000, "customer_id": 14, "sourcedc": "dc"}
rowtime: 2020/05/20 10:10:29.265 Z, key: {"id": 4}, value: {"id": 4, "order_date": 1589969402000, "customer_id": 7, "sourcedc": "dc"}
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Press <code>ctrl-c</code> to stop</p>
</div>
</div>
<div class="sect2">
<h3 id="_ksqldb_streams">ksqlDB Streams</h3>
<div class="paragraph">
<p>In order to work with a stream of data in ksqlDB we first need to register a stream over an existing topic.</p>
</div>
<div class="paragraph">
<p>We can do this using a <code>CREATE STREAM</code> statement. Run the following command to create your first ksqlDB stream:-</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>CREATE STREAM</strong> sales_orders <strong>WITH</strong> (KAFKA_TOPIC='dc_sales_orders', VALUE_FORMAT='AVRO');</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/ksql_001.png" alt="ksql 001">
</div>
</div>
<div class="paragraph">
<p>You should see the following output</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ksql> CREATE STREAM sales_orders WITH (KAFKA_TOPIC='dc_sales_orders', VALUE_FORMAT='AVRO');

 Message
----------------
 Stream created
----------------</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create streams for each of your remaining topics</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>CREATE STREAM</strong> sales_order_details <strong>WITH</strong> (KAFKA_TOPIC='dc_sales_order_details', VALUE_FORMAT='AVRO');
<strong>CREATE STREAM</strong> purchase_orders <strong>WITH</strong> (KAFKA_TOPIC='dc_purchase_orders', VALUE_FORMAT='AVRO');
<strong>CREATE STREAM</strong> purchase_order_details <strong>WITH</strong> (KAFKA_TOPIC='dc_purchase_order_details', VALUE_FORMAT='AVRO');
<strong>CREATE STREAM</strong> products <strong>WITH</strong> (KAFKA_TOPIC='dc_products', VALUE_FORMAT='AVRO');
<strong>CREATE STREAM</strong> customers <strong>WITH</strong> (KAFKA_TOPIC='dc_customers', VALUE_FORMAT='AVRO');
<strong>CREATE STREAM</strong> suppliers <strong>WITH</strong> (KAFKA_TOPIC='dc_suppliers', VALUE_FORMAT='AVRO');</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/ksql_002.png" alt="ksql 002">
</div>
</div>
<div class="paragraph">
<p>To view your current streams run the following command:-</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>SHOW STREAMS;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that each stream is mapped to an underlying Kafka topic and that the format is AVRO.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code> Stream Name            | Kafka Topic                 | Format
---------------------------------------------------------------
 CUSTOMERS              | dc_customers              | AVRO
 PRODUCTS               | dc_products               | AVRO
 PURCHASE_ORDERS        | dc_purchase_orders        | AVRO
 PURCHASE_ORDER_DETAILS | dc_purchase_order_details | AVRO
 SALES_ORDERS           | dc_sales_orders           | AVRO
 SALES_ORDER_DETAILS    | dc_sales_order_details    | AVRO
 SUPPLIERS              | dc_suppliers              | AVRO
---------------------------------------------------------------</code></pre>
</div>
</div>
<div class="paragraph">
<p>To view the details of an individual topic you can you can use the <code>describe</code> command:-</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>DESCRIBE</strong> sales_order_details;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that all the columns have been created for us and we didn&#8217;t need to explicitly set their names and data types when we created the stream, this is one of the advantages of using AVRO and the Schema Registry.</p>
</div>
<div class="paragraph">
<p>Also notice that ksqlDB adds an implicit <code>ROWKEY</code> column to every stream and table, which represents the corresponding Kafka message key.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Name                 : SALES_ORDER_DETAILS
 Field          | Type
-----------------------------------------
 ROWKEY         | VARCHAR(STRING)  (key)
 ID             | INTEGER
 SALES_ORDER_ID | INTEGER
 PRODUCT_ID     | INTEGER
 QUANTITY       | INTEGER
 PRICE          | DECIMAL
 SOURCEDC       | VARCHAR(STRING)
-----------------------------------------
For runtime statistics and query details run: DESCRIBE EXTENDED <Stream,Table>;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Further Reading</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.ksqldb.io/en/latest/">ksqlDB Overview</a></p>
</li>
<li>
<p><a href="https://docs.ksqldb.io/en/latest/developer-guide/create-a-stream/">ksqlDB Streams</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_6_querying_streams_with_ksqldb">Lab 6: Querying Streams with ksqlDB</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two types of query in ksqlDB, <strong>Push</strong> queries and <strong>Pull</strong> queries.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.ksqldb.io/en/latest/developer-guide/ksqldb-reference/select-push-query/">Push Queries</a> enable you to subscribe to a result as it changes in real-time. You can subscribe to the output of any query, including those that return a stream or a materialized aggregate table. The <code>EMIT CHANGES</code> clause is used to indicate a query is a push query.</p>
</li>
<li>
<p><a href="https://docs.ksqldb.io/en/latest/developer-guide/ksqldb-reference/select-pull-query/">Pull Queries</a> enable you to look up information at a point in time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Another important point to understand is where within a stream a query starts to read from. You can control this behaviour using the <code>ksql.streams.auto.offset.reset</code> property. This property can either be set to <code>earliest</code> where data is consumed from the very beginning of the topic or <code>latest</code> where only new data is consumed.</p>
</div>
<div class="paragraph">
<p>To see the current values for <em>all</em> properties run the following command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>SHOW PROPERTIES;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Look out for a property called <code>ksql.streams.auto.offset.reset</code>, it should currently be set to <code>earliest</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code> Property                                               | Default override | Effective Value
--------------------------------------------------------------------------------------------
 ...
 ksql.streams.auto.offset.reset                         |                  | earliest
 ...
--------------------------------------------------------------------------------------------
ksql></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can override this setting to suit you needs:-</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>SET</strong> 'ksql.streams.auto.offset.reset'='earliest';
<strong>SET</strong> 'ksql.streams.auto.offset.reset'='latest';</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or preferably, using the abbreviated property names:-</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>SET</strong> 'auto.offset.reset' = 'latest';
<strong>SET</strong> 'auto.offset.reset' = 'earliest';</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s start by running a Push query and consume all messages from the beginning of a stream.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>SET</strong> 'auto.offset.reset'='earliest';
<strong>SELECT</strong>  id,
        sales_order_id,
        product_id,
        quantity,
        price
<strong>FROM</strong>  sales_order_details
<strong>EMIT CHANGES</strong>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see something similar to this:-</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ksql&gt; SELECT id, sales_order_id, product_id, quantity, price FROM sales_order_details EMIT CHANGES;
+-----------------+-----------------+-----------------+-----------------+-----------------+
|ID               |SALES_ORDER_ID   |PRODUCT_ID       |QUANTITY         |PRICE            |
+-----------------+-----------------+-----------------+-----------------+-----------------+
|1                |1                |1                |10               |2.68             |
|2                |1                |23               |1                |9.01             |
|3                |1                |14               |6                |5.84             |
|4                |2                |12               |7                |4.00             |
|5                |2                |9                |4                |9.83             |
|6                |2                |5                |1                |8.81             |
|7                |2                |3                |8                |9.99             |
|8                |2                |1                |9                |2.68             |
|9                |3                |21               |5                |9.90             |
|10               |3                |2                |1                |8.23             |
|11               |3                |4                |2                |9.78             |
|12               |4                |15               |2                |6.16             |
...
...
|480              |157              |26               |5                |9.03             |
|481              |158              |2                |2                |8.23             |
|482              |159              |10               |4                |5.32             |
|483              |160              |25               |8                |9.00             |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Press <code>ctrl-c</code> to stop</p>
</div>
<div class="paragraph">
<p>Notice that events continue to stream to the console until you explicitly cancel the query, this is because when we are working with streams in ksqlDB the data set is unbounded and could theoretically continue forever.</p>
</div>
<div class="paragraph">
<p>To inspect a bounded set of data, you can use the <code>LIMIT</code> clause.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>SELECT</strong>  id,
        sales_order_id,
        product_id,
        quantity,
        price
<strong>FROM</strong>  sales_order_details
<strong>EMIT CHANGES</strong>
<strong>LIMIT</strong> 10;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we are seeing the first 10 messages that were written to the topic. Notice that the query automatically terminates when the limit of 10 events is reached.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+-----------------+-----------------+-----------------+-----------------+-----------------+
|ID               |SALES_ORDER_ID   |PRODUCT_ID       |QUANTITY         |PRICE            |
+-----------------+-----------------+-----------------+-----------------+-----------------+
|1                |1                |1                |10               |2.68             |
|2                |1                |23               |1                |9.01             |
|3                |1                |14               |6                |5.84             |
|4                |2                |12               |7                |4.00             |
|5                |2                |9                |4                |9.83             |
|6                |2                |5                |1                |8.81             |
|7                |2                |3                |8                |9.99             |
|8                |2                |1                |9                |2.68             |
|9                |3                |21               |5                |9.90             |
|10               |3                |2                |1                |8.23             |
Limit Reached
Query terminated
ksql></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_filtering_streams">Filtering Streams</h3>
<div class="paragraph">
<p>Since ksqlDB is based on SQL, you can do many of the standard SQL things you&#8217;d expect to be able to do, including predicates and projections. The following query will return a stream of  you the latest sales orders where the <code>quantity</code> column is greater than 3.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>SET</strong> 'auto.offset.reset'='latest';
<strong>SELECT</strong>  id,
        product_id,
        quantity
<strong>FROM</strong>    sales_order_details
<strong>WHERE</strong>   quantity > 3
<strong>EMIT CHANGES</strong>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should only see events where the <code>quantity</code> column value is greater than <code>3</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+------------------------------+------------------------------+------------------------------+
|ID                            |PRODUCT_ID                    |QUANTITY                      |
+------------------------------+------------------------------+------------------------------+
|3153                          |22                            |8                             |
|3154                          |4                             |6                             |
|3155                          |9                             |4                             |
|3156                          |25                            |10                            |
|3158                          |24                            |8                             |
|3159                          |7                             |4                             |
|3161                          |28                            |8                             |
|3162                          |22                            |7                             |
|3163                          |24                            |6                             |
|3165                          |5                             |8                             |
|3167                          |21                            |9                             |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Press <code>ctrl-c</code> to stop</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Further Reading</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.confluent.io/current/ksql/docs/developer-guide/syntax-reference.html#push-query">Push Query Syntax</a></p>
</li>
<li>
<p><a href="https://docs.confluent.io/current/ksql/docs/developer-guide/syntax-reference.html#pull-query">Pull Query Syntax</a></p>
</li>
<li>
<p><a href="https://docs.confluent.io/current/ksql/docs/installation/server-config/config-reference.html#ksql-streams-auto-offset-reset">ksqlDB Offset Management</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_7_creating_ksqldb_tables">Lab 7: Creating ksqlDB tables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ksqlDB tables allow you to work the data in topics as key/value pairs, with a single value for each key. Tables can be created from an existing topic or from the query results from other tables or streams. You can read more about this <a href="https://docs.confluent.io/current/streams/concepts.html#duality-of-streams-and-tables">here</a>.</p>
</div>
<div class="sect2">
<h3 id="_creating_tables">Creating Tables</h3>
<div class="paragraph">
<p>We want to create tables over our <code>customers</code>, <code>suppliers</code> and <code>products</code> streams so we can look up the current state for each customer, supplier and product. Later on we&#8217;ll be joining these tables to other streams. To successfully join to a table in ksqlDB you need to ensure that the table is keyed on the column you are going to use in the join. Our underlying topics already have the correct key set thanks to the Debezium MySQL connector configuration so we just need to use the <code>PRIMARY KEY</code> clause when we create each table.</p>
</div>
<div class="paragraph">
<p>Create your 3 ksqlDB tables.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>CREATE TABLE</strong> customers_tbl (
  ROWKEY      INT PRIMARY KEY,
  FIRST_NAME  VARCHAR,
  LAST_NAME   VARCHAR,
  EMAIL       VARCHAR,
  CITY        VARCHAR,
  COUNTRY     VARCHAR,
  SOURCEDC    VARCHAR
)
<strong>WITH</strong> (
  KAFKA_TOPIC='dc_customers',
  VALUE_FORMAT='AVRO'
);</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>CREATE TABLE</strong> suppliers_tbl (
  ROWKEY      INT PRIMARY KEY,
  NAME        VARCHAR,
  EMAIL       VARCHAR,
  CITY        VARCHAR,
  COUNTRY     VARCHAR,
  SOURCEDC    VARCHAR
)
<strong>WITH</strong> (
  KAFKA_TOPIC='dc_suppliers',
  VALUE_FORMAT='AVRO'
);</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>CREATE TABLE</strong> products_tbl (
  ROWKEY      INT PRIMARY KEY,
  NAME        VARCHAR,
  DESCRIPTION VARCHAR,
  PRICE       DECIMAL(10,2),
  COST        DECIMAL(10,2),
  SOURCEDC    VARCHAR
)
<strong>WITH</strong> (
  KAFKA_TOPIC='dc_products',
  VALUE_FORMAT='AVRO'
);</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/ksql_005.png" alt="ksql 005">
</div>
</div>
<div class="paragraph">
<p>We can view our current tables using the following command:-</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>SHOW TABLES;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code> Table Name    | Kafka Topic    | Format | Windowed
----------------------------------------------------
 CUSTOMERS_TBL | dc_customers | AVRO   | false
 PRODUCTS_TBL  | dc_products  | AVRO   | false
 SUPPLIERS_TBL | dc_suppliers | AVRO   | false
----------------------------------------------------</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll use these tables soon and join them to our streams.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Further Reading</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.confluent.io/current/ksql/docs/developer-guide/syntax-reference.html#create-table">CREATE TABLE Syntax</a></p>
</li>
<li>
<p><a href="https://docs.confluent.io/current/ksql/docs/developer-guide/syntax-reference.html#describe">DESCRIBE Syntax</a></p>
</li>
<li>
<p><a href="https://docs.confluent.io/current/ksql/docs/developer-guide/syntax-reference.html#create-stream-as-select">CREATE STREAM AS SELECT Syntax</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_8_joining_steams_tables_with_ksqldb">Lab 8: Joining Steams &amp; Tables with ksqlDB</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We can join two streams together in ksqlDB using a windowed join. When using a windowed join, you must specify a windowing scheme by using the <code>WITHIN</code> clause. A new input record on one side produces a join output for each matching record on the other side, and there can be multiple such matching records within a join window.</p>
</div>
<div class="paragraph">
<p>In the example below you can see that we are joining the <code>sales_orders</code> stream to the <code>sales_order_details</code> stream using a window of 1 seconds (<code>INNER JOIN sales_order_details od WITHIN 1 SECONDS ON (o.id = od.sales_order_id)</code>). The orders application creates sales orders and their associated sales order detail rows at the same time, so 1 second will be plenty of time to ensure that a join takes place.</p>
</div>
<div class="paragraph">
<p>We are also joining to the <code>customers_tbl</code> and <code>products_tbl</code> tables</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>SET 'auto.offset.reset'='earliest';
<strong>CREATE STREAM</strong> sales_enriched <strong>WITH</strong> (PARTITIONS = 1, KAFKA_TOPIC = 'dc_sales_enriched') AS SELECT
    o.id order_id,
    od.id order_details_id,
    o.order_date,
    od.product_id product_id,
    pt.name product_name,
    pt.description product_desc,
    od.price product_price,
    od.quantity product_qty,
    o.customer_id customer_id,
    ct.first_name customer_fname,
    ct.last_name customer_lname,
    ct.email customer_email,
    ct.city customer_city,
    ct.country customer_country
<strong>FROM</strong> sales_orders o
<strong>INNER JOIN</strong> sales_order_details od WITHIN 1 SECONDS ON (o.id = od.sales_order_id)
<strong>INNER JOIN</strong> customers_tbl ct ON (o.customer_id = ct.rowkey)
<strong>INNER JOIN</strong> products_tbl pt ON (od.product_id = pt.rowkey);</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/ksql_006.png" alt="ksql 006">
</div>
</div>
<div class="paragraph">
<p>If we run a describe on this stream&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>DESCRIBE</strong> sales_enriched;</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;you&#8217;ll see that we have effectively denormalized the <code>sales_orders</code>, <code>sales_order_details</code>, <code>customers</code> and <code>products</code> streams/tables into a single event stream.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Name                 : SALES_ENRICHED
 Field            | Type
-------------------------------------------
 ROWKEY           | INTEGER          (key)
 ORDER_ID         | INTEGER
 ORDER_DETAILS_ID | INTEGER
 ORDER_DATE       | BIGINT
 PRODUCT_ID       | INTEGER
 PRODUCT_NAME     | VARCHAR(STRING)
 PRODUCT_DESC     | VARCHAR(STRING)
 PRODUCT_PRICE    | DECIMAL
 PRODUCT_QTY      | INTEGER
 CUSTOMER_ID      | INTEGER
 CUSTOMER_FNAME   | VARCHAR(STRING)
 CUSTOMER_LNAME   | VARCHAR(STRING)
 CUSTOMER_EMAIL   | VARCHAR(STRING)
 CUSTOMER_CITY    | VARCHAR(STRING)
 CUSTOMER_COUNTRY | VARCHAR(STRING)
-------------------------------------------</code></pre>
</div>
</div>
<div class="paragraph">
<p>We now need to create an equivalent <code>purchases_enriched</code> stream that combines the <code>purchase_orders</code>, <code>purchase_order_details</code>, <code>suppliers</code> and <code>products</code> streams/tables. Since the purchases data model is very similar to that of the sales data model the query looks very similar.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>SET 'auto.offset.reset'='earliest';
<strong>CREATE STREAM</strong> purchases_enriched <strong>WITH</strong> (PARTITIONS = 1, KAFKA_TOPIC = 'dc_purchases_enriched') AS SELECT
    o.id order_id,
    od.id order_details_id,
    o.order_date,
    od.product_id product_id,
    pt.name product_name,
    pt.description product_desc,
    od.cost product_cost,
    od.quantity product_qty,
    o.supplier_id supplier_id,
    st.name supplier_name,
    st.email supplier_email,
    st.city supplier_city,
    st.country supplier_country
<strong>FROM</strong> purchase_orders o
<strong>INNER JOIN</strong> purchase_order_details od WITHIN 1 SECONDS ON (o.id = od.purchase_order_id)
<strong>INNER JOIN</strong> suppliers_tbl st ON (o.supplier_id = st.rowkey)
<strong>INNER JOIN</strong> products_tbl pt ON (od.product_id = pt.rowkey);</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/ksql_007.png" alt="ksql 007">
</div>
</div>
<div class="paragraph">
<p>If we run a describe on this stream&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>DESCRIBE</strong> purchases_enriched;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Name                 : PURCHASES_ENRICHED
 Field            | Type
-------------------------------------------
 ROWKEY           | INTEGER          (key)
 ORDER_ID         | INTEGER
 ORDER_DETAILS_ID | INTEGER
 ORDER_DATE       | BIGINT
 PRODUCT_ID       | INTEGER
 PRODUCT_NAME     | VARCHAR(STRING)
 PRODUCT_DESC     | VARCHAR(STRING)
 PRODUCT_COST     | DECIMAL
 PRODUCT_QTY      | INTEGER
 SUPPLIER_ID      | INTEGER
 SUPPLIER_NAME    | VARCHAR(STRING)
 SUPPLIER_EMAIL   | VARCHAR(STRING)
 SUPPLIER_CITY    | VARCHAR(STRING)
 SUPPLIER_COUNTRY | VARCHAR(STRING)
-------------------------------------------</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;you&#8217;ll see that we have also denormalized the <code>purchase_orders</code>, <code>purchase_order_details</code>, <code>suppliers</code> and <code>products</code> streams/tables into a single event stream.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s query the <code>purchases_enriched</code> stream from the very beginning</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>SET</strong> 'auto.offset.reset'='earliest';
<strong>SELECT</strong> product_id,
       product_name,
       product_qty
<strong>FROM</strong> purchases_enriched
<strong>EMIT CHANGES</strong>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the query returns the first 30 purchase order lines and then stops; this is because no purchase orders are being created by our orders application. The orders application will raise purchase orders for us when we send it some out of stock events.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+-------------------------+----------------------------------+------------------------+
|PRODUCT_ID               |PRODUCT_NAME                      |PRODUCT_QTY             |
+-------------------------+----------------------------------+------------------------+
|1                        |Yogurt - Assorted Pack            |100                     |
|2                        |Ostrich - Fan Fillet              |100                     |
|3                        |Fish - Halibut, Cold Smoked       |100                     |
|4                        |Tomatoes Tear Drop Yellow         |100                     |
|5                        |Pasta - Fettuccine, Egg, Fresh    |100                     |
|6                        |Plastic Wrap                      |100                     |
|7                        |Pineapple - Regular               |100                     |
|8                        |Quail - Eggs, Fresh               |100                     |
|9                        |Pork - Ground                     |100                     |
|10                       |Lamb Shoulder Boneless Nz         |100                     |
|11                       |Sausage - Meat                    |100                     |
|12                       |Herb Du Provence - Primerba       |100                     |
|13                       |Bread - Kimel Stick Poly          |100                     |
|14                       |Food Colouring - Red              |100                     |
|15                       |Cheese - Grie Des Champ           |100                     |
|16                       |Longos - Lasagna Veg              |100                     |
|17                       |Beets - Golden                    |100                     |
|18                       |Bread - Dark Rye                  |100                     |
|19                       |Pepperoni Slices                  |100                     |
|20                       |Glass - Wine, Plastic, Clear 5 Oz |100                     |
|21                       |Soup - Campbells, Beef Barley     |100                     |
|22                       |Bread - Kimel Stick Poly          |100                     |
|23                       |Plate - Foam, Bread And Butter    |100                     |
|24                       |Parsley - Fresh                   |100                     |
|25                       |Cookie - Oreo 100x2               |100                     |
|26                       |Bread - Crusty Italian Poly       |100                     |
|27                       |Wine - Chateauneuf Du Pape        |100                     |
|28                       |Country Roll                      |100                     |
|29                       |Wine - Redchard Merritt           |100                     |
|30                       |Doilies - 5, Paper                |100                     |</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Further Reading</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.ksqldb.io/en/latest/developer-guide/joins/join-streams-and-tables/">Stream-Table Joins</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_9_streaming_current_stock_levels">Lab 9: Streaming Current Stock Levels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we can create an out of stock event stream, we need to work out the current stock levels for each product. We can do this by combining the <code>sales_enriched</code> stream with the <code>purchases_enriched</code> stream and summing the <code>sales_enriched.quantity</code> column (stock decrements) and the <code>purchases_enriched.quantity</code> column (stock increments).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a go at this now by creating a new stream called <code>product_supply_and_demand</code>. This stream is consuming messages from the <code>sales_enriched</code> stream and included the <code>product_id</code> and <code>quantity</code> column converted to a negative value, we do this because sales events are our <em>demand</em> and hence decrement stock.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>SET</strong> 'auto.offset.reset'='earliest';
<strong>CREATE STREAM</strong> product_supply_and_demand <strong>WITH</strong> (PARTITIONS=1, KAFKA_TOPIC='dc_product_supply_and_demand') <strong>AS SELECT</strong>
  product_id,
  product_qty * -1 "QUANTITY"
<strong>FROM</strong> sales_enriched;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/ksql_012.png" alt="ksql 012">
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s have a quick look at the first few rows of this stream</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>SET</strong> 'auto.offset.reset'='earliest';
<strong>SELECT</strong>  product_id,
        quantity
<strong>FROM</strong>    product_supply_and_demand
<strong>EMIT CHANGES</strong>
<strong>LIMIT</strong> 10;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This query shows a history of all sales and their affect on stock levels.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+------------------------------------------+------------------------------------------+
|PRODUCT_ID                                |QUANTITY                                  |
+------------------------------------------+------------------------------------------+
|1                                         |-6                                        |
|15                                        |-3                                        |
|14                                        |-7                                        |
|23                                        |-3                                        |
|13                                        |-10                                       |
|4                                         |-9                                        |
|10                                        |-9                                        |
|15                                        |-8                                        |
|10                                        |-2                                        |
|27                                        |-7                                        |
Limit Reached
Query terminated</code></pre>
</div>
</div>
<div class="paragraph">
<p>What we need to do now is also include all product purchases in the same stream. We can do this using an <code>INSERT INTO</code> statement. The <code>INSERT INTO</code> statement streams the result of a SELECT query into an existing stream and its underlying topic.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>INSERT INTO</strong> product_supply_and_demand
  <strong>SELECT</strong>  product_id,
          product_qty "QUANTITY"
  <strong>FROM</strong>    purchases_enriched;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/ksql_013.png" alt="ksql 013">
</div>
</div>
<div class="paragraph">
<p>Our <code>product_supply_and_demand</code> now includes all product sales as stock decrements and all product purchases as stock increments.</p>
</div>
<div class="paragraph">
<p>We can see the demand for a single product by filtering on the <code>product_id</code> and including only events where the <code>quantity</code> is less than zero, i.e. stock decrements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>SET</strong> 'auto.offset.reset'='earliest';
<strong>SELECT</strong>  product_id,
        quantity
<strong>FROM</strong>    product_supply_and_demand
<strong>WHERE</strong> product_id = 15
<strong>AND</strong>   quantity < 0
<strong>EMIT CHANGES</strong>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+------------------------------------------+------------------------------------------+
|PRODUCT_ID                                |QUANTITY                                  |
+------------------------------------------+------------------------------------------+
|1                                         |-6                                        |
|1                                         |-9                                        |
|1                                         |-7                                        |
|1                                         |-5                                        |
|1                                         |-1                                        |
|1                                         |-7                                        |
|1                                         |-7                                        |
|1                                         |-10                                       |
|1                                         |-8                                        |
|1                                         |-4                                        |
|1                                         |-2                                        |
...
...
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also see the supply for a single product by filtering on the <code>product_id</code> and including only events where the <code>quantity</code> is greater than zero, i.e. stock increments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>SET</strong> 'auto.offset.reset'='earliest';
<strong>SELECT</strong>  product_id,
        quantity
<strong>FROM</strong>    product_supply_and_demand
<strong>WHERE</strong> product_id = 15
<strong>AND</strong>   quantity > 0
<strong>EMIT CHANGES</strong>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This query will only return a single event and reflects the initial purchase order line that was raised for this product.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+------------------------------------------+------------------------------------------+
|PRODUCT_ID                                |QUANTITY                                  |
+------------------------------------------+------------------------------------------+
|1                                         |100                                       |</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;re now is a position where we can calculate the current stock level for each product. We can do this by creating a table that groups by the <code>product_id</code> and sums up the <code>quantity</code> column which contains both stock decrements and stock increments.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>SET</strong> 'auto.offset.reset'='earliest';
<strong>CREATE TABLE</strong> current_stock <strong>WITH</strong> (PARTITIONS = 1, KAFKA_TOPIC = 'dc_current_stock') <strong>AS SELECT</strong>
      product_id
    , SUM(quantity) "STOCK_LEVEL"
<strong>FROM</strong> product_supply_and_demand
<strong>GROUP BY</strong> product_id;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/ksql_014.png" alt="ksql 014">
</div>
</div>
<div class="paragraph">
<p>When we query this table with a Push query&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>SET</strong> 'auto.offset.reset'='latest';
<strong>SELECT</strong>  product_id,
        stock_level
<strong>FROM</strong>  current_stock
<strong>EMIT CHANGES</strong>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;each new event that is displayed on the console reflects the current stock level for the associated product, a new event will be emitted  each time a product&#8217;s stock level changes.
Depending on how long it took you to get to this point in the workshop, you may see that all your stock levels are negative. This is because, apart from the initial purchase order for 100 of each product, we have not created any more purchase orders and our customers will have their orders on hold until we acquire more stock, not good, but we&#8217;ll fix that soon.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Further Reading</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.ksqldb.io/en/latest/developer-guide/ksqldb-reference/insert-into/">INSERT INTO Syntax</a></p>
</li>
<li>
<p><a href="https://docs.ksqldb.io/en/latest/developer-guide/ksqldb-reference/create-table-as-select/">CREATE TABLE AS SELECT Syntax</a></p>
</li>
<li>
<p><a href="https://docs.ksqldb.io/en/latest/developer-guide/ksqldb-reference/create-table-as-select/">ksqlDB Aggregate Functions</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_10_pull_queries">Lab 10: Pull Queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We can now run our first Pull query. Pull queries are used against tables with aggregates and can only query a single key.</p>
</div>
<div class="paragraph">
<p>To run a Pull query we just query the table as normal but drop the <code>EMIT CHANGES</code> clause. In this query we are asking "<strong>what is the <em>current</em> stock level for product id 1?</strong>"</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>select product_id, stock_level from current_stock where rowkey=15;</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/ksql_015.png" alt="ksql 015">
</div>
</div>
<div class="paragraph">
<p>The query will return the current stock level and immediatly terminate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+----------------------------------------------------+----------------------------------------------------+
|PRODUCT_ID                                          |STOCK_LEVEL                                         |
+----------------------------------------------------+----------------------------------------------------+
|1                                                   |-67                                                 |
Query terminated</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also use the ksqlDB Server&#8217;s REST endpoint to make Pull queries.</p>
</div>
<div class="paragraph">
<p>Exit from the ksqlDB CLI and run the following from the command line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>curl -s -X "POST" "http://localhost:8088/query" -H "Content-Type: application/vnd.ksql.v1+json; charset=utf-8" -d $'{ "ksql": "select product_id, stock_level from current_stock where rowkey=15;" }'| jq .</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the ksqlDB Server&#8217;s REST endpoint will return a JSON message with the <code>product_id</code> and its current <code>stock_level</code>. This is useful for applications that want access to the current state of the world using a request/response type pattern.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>[
  {
    "header": {
      "queryId": "query_1582892390468",
      "schema": "`PRODUCT_ID` INTEGER, <code>STOCK_LEVEL</code> INTEGER"
    }
  },
  {
    "row": {
      "columns": [
        1,
        -76
      ]
    }
  }
]</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Further Reading</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.ksqldb.io/en/latest/developer-guide/ksqldb-reference/select-pull-query/">Pull Queries</a></p>
</li>
<li>
<p><a href="https://docs.ksqldb.io/en/latest/developer-guide/api/">ksqlDB REST API</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_11_streaming_recent_product_demand">Lab 11: Streaming Recent Product Demand</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we know the current stock level is for each product, we can use this information to send an event to the orders application and ask it to create purchase orders to replenish the stock, but how much should we stock should we order? we could just order enough to satisfy the current backlog but we&#8217;d quickly run out of stock again.</p>
</div>
<div class="paragraph">
<p>What we really want to do is order enough to satisfy the backlog <em>and</em> enough to meet future demand, we can make an attempt at predicting what the future demand will be by looking at the past.</p>
</div>
<div class="paragraph">
<p>In the following query we are creating a table that will calculate the demand for each product over the last 3 minutes using a <code>WINDOW HOPPING</code> clause.</p>
</div>
<div class="paragraph">
<p>Hopping windows are based on time intervals. They model fixed-sized, possibly overlapping windows. A hopping window is defined by two properties: the windows duration and its advance, or hop, interval. The advance interval specifies how far a window moves forward in time relative to the previous window. In our query we we have a window with a duration of three minutes and an advance interval of one minute. Because hopping windows can overlap, a record can belong to more than one such window.</p>
</div>
<div class="paragraph">
<p>Start the ksqlDB CLI if you haven&#8217;t already</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>docker exec -it ksqldb-cli ksql http://ksqldb-server-ccloud:8088</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create the windowed query</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>SET</strong> 'auto.offset.reset'='earliest';
<strong>CREATE TABLE</strong> product_demand_last_3mins_tbl <strong>WITH</strong> (PARTITIONS = 1, KAFKA_TOPIC = 'dc_product_demand_last_3mins')
<strong>AS SELECT</strong>
      timestamptostring(windowStart,'HH:mm:ss') "WINDOW_START_TIME"
    , timestamptostring(windowEnd,'HH:mm:ss') "WINDOW_END_TIME"
    , product_id
    , <strong>SUM</strong>(product_qty) "DEMAND_LAST_3MINS"
<strong>FROM</strong> sales_enriched
<strong>WINDOW HOPPING</strong> (SIZE 3 MINUTES, ADVANCE BY 1 MINUTE)
<strong>GROUP BY</strong> product_id <strong>EMIT CHANGES</strong>;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/ksql_016.png" alt="ksql 016">
</div>
</div>
<div class="paragraph">
<p>If we query this table for a single product&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>SET</strong> 'auto.offset.reset'='latest';
<strong>SELECT</strong>  window_start_time,
        window_end_time,
        product_id,
        demand_last_3mins
<strong>FROM</strong>  product_demand_last_3mins_tbl
<strong>WHERE</strong> product_id = 15
<strong>EMIT CHANGES</strong>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;you&#8217;ll see the start and end times for each three minute window, along with the product demand for those 3 minutes. Notice how the window start times are staggered by one minute, this is the advance interval in action. As new sales events occur a new message will be displayed with an update to the window(s) total.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+-----------------+-----------------+-----------------+-----------------+
|WINDOW_START_TIME|WINDOW_END_TIME  |PRODUCT_ID       |DEMAND_LAST_3MINS|
+-----------------+-----------------+-----------------+-----------------+
|13:33:00         |13:36:00         |1                |10               |
|13:34:00         |13:37:00         |1                |10               |
|13:35:00         |13:38:00         |1                |1                |
|13:33:00         |13:36:00         |1                |11               |
|13:34:00         |13:37:00         |1                |11               |
|13:35:00         |13:38:00         |1                |2                |
|13:34:00         |13:37:00         |1                |21               |
|13:35:00         |13:38:00         |1                |12               |
|13:36:00         |13:39:00         |1                |10               |
|13:34:00         |13:37:00         |1                |26               |
|13:35:00         |13:38:00         |1                |17               |
|13:36:00         |13:39:00         |1                |15               |
|13:35:00         |13:38:00         |1                |22               |
|13:36:00         |13:39:00         |1                |20               |
|13:37:00         |13:40:00         |1                |5                |
|13:36:00         |13:39:00         |1                |28               |
|13:37:00         |13:40:00         |1                |13               |
|13:38:00         |13:41:00         |1                |8                |</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will now create a stream from this table and then join it to the <code>current_stock</code> table</p>
</div>
<div class="paragraph">
<p>Create a stream from the table&#8217;s underlying topic&#8230;&#8203;</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>CREATE STREAM</strong> product_demand_last_3mins <strong>WITH</strong> (KAFKA_TOPIC='dc_product_demand_last_3mins', VALUE_FORMAT='AVRO');</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/ksql_017.png" alt="ksql 017">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Further Reading</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.ksqldb.io/en/latest/concepts/time-and-windows-in-ksqldb-queries/#windows-in-sql-queries">Windows in ksqlDB Queries</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_12_streaming_out_of_stock_events">Lab 12: Streaming <em>"Out of Stock"</em> Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have the <code>current_stock</code> table and <code>product_demand_last_3mins</code> stream, we can create a <code>out_of_stock_events</code> stream by joining the two together and calculating the required purchase order quantity. We calculate the <code>purchase_qty</code> from adding the inverse of the current stock level to the last 3 minutes of demand. The stream is filtered to only include products that have negative stock and therefore need purchase orders raising for them.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>SET</strong> 'auto.offset.reset' = 'latest';
<strong>CREATE STREAM</strong> out_of_stock_events <strong>WITH</strong> (PARTITIONS = 1, KAFKA_TOPIC = 'dc_out_of_stock_events')
<strong>AS SELECT</strong>
  cs.product_id "PRODUCT_ID",
  pd.window_start_time,
  pd.window_end_time,
  cs.stock_level,
  pd.demand_last_3mins,
  (cs.stock_level * -1) + pd.DEMAND_LAST_3MINS "QUANTITY_TO_PURCHASE"
<strong>FROM</strong> product_demand_last_3mins pd
<strong>INNER JOIN</strong> current_stock cs <strong>ON</strong> pd.product_id = cs.product_id
<strong>WHERE</strong> stock_level <= 0;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/ksql_018.png" alt="ksql 018">
</div>
</div>
<div class="paragraph">
<p>When we query the <code>out_of_stock_events</code> stream&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code><strong>SET</strong> 'auto.offset.reset' = 'latest';
<strong>SELECT</strong> product_id,
       window_start_time,
       window_end_time,
       stock_level,
       demand_last_3mins,
       quantity_to_purchase
<strong>FROM</strong> out_of_stock_events
<strong>EMIT CHANGES</strong>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;you&#8217;ll see a constant stream of <em>out of stock products</em> and the predicted purchase quantity that should be ordered to satisfy any current backlog and also meet the next 3 minutes demand.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+----------------+------------------+----------------+-------------+-----------------+-------------------+
|PRODUCT_ID      |WINDOW_START_TIME |WINDOW_END_TIME |STOCK_LEVEL  |DEMAND_LAST_3MINS|QUANTITY_TO_PURCASE|
+----------------+------------------+----------------+-------------+-----------------+-------------------+
|28              |13:53:00          |13:56:00        |-85          |12               |97                 |
|28              |13:54:00          |13:57:00        |-85          |1                |86                 |
|28              |13:55:00          |13:58:00        |-85          |1                |86                 |
|4               |13:53:00          |13:56:00        |-128         |26               |154                |
|4               |13:54:00          |13:57:00        |-128         |11               |139                |
|4               |13:55:00          |13:58:00        |-128         |11               |139                |
|5               |13:53:00          |13:56:00        |-73          |15               |88                 |
|5               |13:54:00          |13:57:00        |-73          |15               |88                 |
|5               |13:55:00          |13:58:00        |-73          |15               |88                 |
|28              |13:53:00          |13:56:00        |-85          |18               |103                |
|28              |13:54:00          |13:57:00        |-91          |7                |98                 |
|28              |13:55:00          |13:58:00        |-91          |7                |98                 |
|14              |13:53:00          |13:56:00        |-156         |31               |187                |
|14              |13:54:00          |13:57:00        |-156         |15               |171                |
|14              |13:55:00          |13:58:00        |-156         |6                |162                |
|5               |13:53:00          |13:56:00        |-73          |25               |98                 |
|5               |13:54:00          |13:57:00        |-83          |25               |108                |
|5               |13:55:00          |13:58:00        |-83          |25               |108                |
|12              |13:53:00          |13:56:00        |-197         |25               |222                |
|12              |13:54:00          |13:57:00        |-197         |21               |218                |
|12              |13:55:00          |13:58:00        |-200         |3                |203                |
...
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_13_replicate_events_to_on_premise_kafka">Lab 13: Replicate Events to On-Premise Kafka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The next step is to replicate the <code>out_of_stock_events</code> topic to our on-premise cluster.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/5_replicate_to_onprem.png" alt="5 replicate to onprem">
</div>
</div>
<div class="paragraph">
<p>Before we do that, let&#8217;s create the target topic in our on-premise Kafka cluster using <a href="http://localhost:9021" target="<em>blank">Confluent Control Center</a>
Select your on-premise cluster from the left-hand navigation bar, select _"topics"</em> and then click on <em>"Add a Topic"</em>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="imageblock">
<div class="content">
<img src="./images/c3_80.png" alt="c3 80">
</div>
</div>
<div class="paragraph">
<p>Name the topic <code>dc_out_of_stock_events</code> with one partition and click <em>"Create with defaults"</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/c3_90.png" alt="c3 90">
</div>
</div>
<div class="paragraph">
<p>We are now ready to replicate this topic from Confluent Cloud to your on-premise cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_submit_the_replicator_connector_config">Submit the Replicator Connector Config</h3>
<div class="paragraph">
<p>Execute the following to create the Replicator Connector.</p>
</div>
<div class="paragraph">
<p>Exit the ksqlDB cli</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>exit</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create the connector using the cURL command.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>curl -i -X POST -H "Accept:application/json" \
    -H  "Content-Type:application/json" http://localhost:18083/connectors/ \
    -d '{
        "name": "replicator-ccloud-to-dc",
        "config": {
          "connector.class": "io.confluent.connect.replicator.ReplicatorSourceConnector",
          "key.converter": "io.confluent.connect.replicator.util.ByteArrayConverter",
          "value.converter": "io.confluent.connect.replicator.util.ByteArrayConverter",
          "topic.config.sync": "false",
          "topic.whitelist": "dc_out_of_stock_events",
          "dest.kafka.bootstrap.servers": "broker:29092",
          "dest.kafka.replication.factor": 1,
          "src.kafka.bootstrap.servers": "${file:/secrets.properties:CCLOUD_CLUSTER_ENDPOINT}",
          "src.kafka.security.protocol": "SASL_SSL",
          "src.kafka.sasl.mechanism": "PLAIN",
          "src.kafka.sasl.jaas.config": "org.apache.kafka.common.security.plain.PlainLoginModule required username=\"${file:/secrets.properties:CCLOUD_API_KEY}\" password=\"${file:/secrets.properties:CCLOUD_API_SECRET}\";",
          "src.consumer.group.id": "replicator-ccloud-to-dc",
          "src.consumer.interceptor.classes": "io.confluent.monitoring.clients.interceptor.MonitoringConsumerInterceptor",
          "src.consumer.confluent.monitoring.interceptor.bootstrap.servers": "${file:/secrets.properties:CCLOUD_CLUSTER_ENDPOINT}",
          "src.kafka.timestamps.producer.interceptor.classes": "io.confluent.monitoring.clients.interceptor.MonitoringProducerInterceptor",
          "src.kafka.timestamps.producer.confluent.monitoring.interceptor.bootstrap.servers": "${file:/secrets.properties:CCLOUD_CLUSTER_ENDPOINT}",
          "tasks.max": "1"
        }
    }'</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Notice that we&#8217;ve specified only to replicate the <code>dc_out_of_stock_events</code> topic by configuring <code>"topic.whitelist": "dc_out_of_stock_events"</code></p>
</div>
<div class="paragraph">
<p>We can confirm that the <code>dc_out_of_stock_events</code> is being replicated from Confluent Cloud to our on-premise cluster by checking for messages in <a href="http://localhost:9021" target="_blank" rel="noopener">Confluent Control Center</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/c3_100.png" alt="c3 100">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Further Reading</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.confluent.io/current/connect/kafka-connect-replicator/index.html">Confluent Replicator</a></p>
</li>
<li>
<p><a href="https://docs.confluent.io/current/connect/kafka-connect-replicator/configuration_options.html">Confluent Replicator Configuration Properties</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_14_sink_events_into_mysql">Lab 14: Sink Events into MySQL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Finally we need to sink the <code>dc_out_of_stock_events</code> topic into a MySQL database table, the on-premise application will then process these events and create purchase order for us.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/6_jdbc_sink.png" alt="6 jdbc sink">
</div>
</div>
<div class="paragraph">
<p>But before we do that, let&#8217;s open a couple more terminal sessions and start the ksqlDB CLI in each.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ssh dc@localhost</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>docker exec -it ksqldb-cli ksql http://ksqldb-server-ccloud:8088</code></pre>
</div>
</div>
<div class="paragraph">
<p>Execute the following query in the 1st session&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>SET 'auto.offset.reset'='latest';
SELECT  product_id,
        stock_level
FROM  current_stock
EMIT CHANGES;</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and this query in the 2nd session</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>SET 'auto.offset.reset'='latest';
SELECT  product_id,
        product_qty
FROM  purchases_enriched
EMIT CHANGES;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You now have a real time view of the current product stock levels in the first ksqlDB session and the purchases being made to replenish the stock in second. Not that the second query isn&#8217;t returning anything yet.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s now sink the <em>out of stock events</em> to the MySQL database using the JDBC Connector. Once the events start arriving in the database, the orders application will process them and start generating the required purchase orders.</p>
</div>
<div class="paragraph">
<p>In a third terminal session, create the JDBC Sink Connector by running the following from the command line.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>curl -i -X POST -H "Accept:application/json" \
    -H  "Content-Type:application/json" http://localhost:18083/connectors/ \
    -d '{
        "name": "jdbc-mysql-sink",
        "config": {
          "connector.class": "io.confluent.connect.jdbc.JdbcSinkConnector",
          "topics": "dc_out_of_stock_events",
          "connection.url": "jdbc:mysql://mysql:3306/orders",
          "connection.user": "mysqluser",
          "connection.password": "mysqlpw",
          "insert.mode": "INSERT",
          "batch.size": "3000",
          "auto.create": "true",
          "key.converter": "org.apache.kafka.connect.storage.StringConverter"
       }
    }'</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Observe the current stock query in the first ksqlDB session, when a product has zero or less stock you should see a purchase event appear in the second ksqlDB session and then the new stock level reflected in the first session. In theory, given a constant demand, each product should run out of stock and get replenished roughly every 3 minutes.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Further Reading</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.confluent.io/current/connect/kafka-connect-jdbc/sink-connector/index.html#jdbc-sink-connector-for-cp">JDBC Sink Connector</a></p>
</li>
<li>
<p><a href="https://docs.confluent.io/current/connect/kafka-connect-jdbc/sink-connector/sink_config_options.html">JDBC Sink Connector Configuration Properties</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><mark>EXTENSIONS_PLACEHOLDER</mark></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wrapping_up">Wrapping up</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During this workshop we have seen how the Confluent Platform and Confluent Cloud can be used to build event driven, real time applications that span the data center and public cloud.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-07-08 11:54:54 +0200
</div>
</div>
</body>
</html>